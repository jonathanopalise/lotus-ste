# Lotus STE

_Enhancements to the Atari ST version of Lotus Esprit Turbo Challenge to support STE hardware features_

![Screenshot of current progress](https://github.com/jonathanopalise/lotus-ste/blob/master/screenshot.png)

This project is at an early stage and no builds are currently available to end users.

Credits:

* **Graphics enhancements**: Chicane/AF (Jonathan Thomas)
* **Sound enhancements**: Junosix/AF
* **Loader and other technical assistance**: Grazey/PHF

**Thanks to**: metalages/AF, masteries/AF

_(AF = Atari-Forum - https://www.atari-forum.com/)_

Directory layout is as follows:

* `bin` - contains binary patches generated by means of compiling the code in `src`;
* `doc` - contains informal documentation pertaining to the reverse engineering efforts of the ST side;
* `gamefiles` - contains a `source` directory that must be manually populated with the contents of the Empire crack of Lotus (see below) before running the Makefile. Also contains a `destination` directory used as an intermediate step in the build process;
* `release` - contains a bootable disk image named `lotus_ste.st` upon successful completion of the build process.
* `src` - contains the core source code to generate the code for use on the ST side. There is a `generated` subdirectory within that contains machine generated source files;
* `util` - contains utilities for use in reverse engineering efforts.

The build process is controlled by a `Makefile`. The `Makefile` is designed for use with Linux but I imagine it could be repurposed for Windows or Mac with some changes. Before attempting to run the `Makefile`, you'll need to obtain the "Empire" crack of Lotus, which needs to obtained separately from the usual channels. The filename of this disk image is `Lotus Esprit Turbo Challenge (1990)(Gremlin)[cr Empire][a].st` and the md5sum is `942911068dd0a82debfba6d45d3370c4`.

Once the disk image has been obtained, the `gamefiles/source` directory needs to be populated with the contents of the root directory of the above disk image. This can be done by using the Hatari emulator (https://hatari.tuxfamily.org/) to map a Gemdos hard drive to a directory on the host machine, entering the GEM environment on the Atari ST, and copying the files from drive A: to drive C:, at which point they should appear on the filesystem of the host machine, within the directory assigned to the Gemdos hard drive. The files will then need to be copied from this location to the `gamefiles/source` directory.

Following the above step, run `make` to start the build process. The following executable dependencies will need to be present in the path:

- `vasm` (http://sun.hasenbraten.de/vasm/)
- `vlink` (http://sun.hasenbraten.de/vlink/)
- `m68k-ataribrownest-elf-nm` (https://bitbucket.org/ggnkua/bigbrownbuild-git/src/master/)
- `php` (https://www.php.net/)
- `lz4` (https://github.com/lz4/lz4)
- `zip2st` (packaged with the Hatari emulator - https://hatari.tuxfamily.org/)
- `zip` (commonly packaged with Linux distributions)
- `upx` (https://upx.github.io/)

Should the build process succeed, there will be a `lotus_ste.st` file present within the `release` directory that can be run within an emulator such as Hatari (https://hatari.tuxfamily.org/) or transferred elsewhere to run on real STE hardware. Whether running on an emulator or real hardware, the machine will need to be configured as an STE with one meg or more of memory. In the event that the build process fails, please raise an issue against the project and I'll help in any way I can.

Upon booting the newly generated disk image, the following changes should be evident once in-game:

* The road is rendered by the Blitter and features graphical details resembling those of the Amiga version;
* All roadside scenery and cars are rendered by the blitter at single-pixel horizontal accuracy (as opposed to at 16 pixel intervals on the standard ST version);
* The background features a gradient of raster bars resembling those of the Amiga version (currently player 1 only);
* The road and roadside colours are refined to leverage the enhanced STE colour palette;
* Sampled sound effects and engine noise are present (currently player 1 only).

Possible forthcoming objectives for this project are as follows:

* Add further zoom levels for trackside objects.
